digraph G {
    // Graph settings
    rankdir=LR;  // Left to Right direction for overall flow
    size="40,20";  // Much larger dimensions
    dpi=400;  // Higher DPI
    ratio=fill;
    concentrate=true;
    node [shape=box, style="rounded,filled", fontname="Arial", fontsize=14, margin=0.4]; // Larger font and margin
    edge [fontname="Arial", fontsize=12, penwidth=2.0]; // Thicker edges, larger font
    splines=true;
    
    // Legend
    subgraph cluster_legend {
        label = "Legend";
        fontsize=14;
        fontname="Arial Bold";
        style="rounded";
        color=gray;
        node [margin=0.2, fontsize=12];
        
        main [label="Main Operation", fillcolor="gold1", penwidth=1];
        position [label="Position Movement", fillcolor="skyblue", penwidth=1];
        action [label="Action Step", fillcolor="lightgreen", penwidth=1];
        servo [label="Servo Action", shape="box", style="filled", fillcolor="skyblue", penwidth=1];
        servo_icon [label="", shape="square", style="filled", fillcolor="pink", width=0.3, height=0.3, fixedsize=true];
    }
    
    // Start node (outside of locations)
    start [label="1. WAIT FOR SIGNAL\n• System ready and waiting\n• Monitoring for trigger input\n• Cycle begins with signal", fillcolor="gold1"];

    // Define the subgraphs with proper layout
    // Pickup location subgraph (uses TB direction internally)
    subgraph cluster_pickup {
        rankdir=TB; // Enforce top to bottom within this cluster
        label = "PICKUP LOCATION (LEFT)";
        fontsize=16;
        fontname="Arial Bold";
        style="rounded,dashed";
        color="darkblue";
        bgcolor="aliceblue";
        penwidth=2.0;
        
        move_to_pickup [label="2. MOVE TO PICKUP LOCATION ◼\n• Position arm at pickup location\n• Prepare for pickup sequence", fillcolor="skyblue"];
        
        lower_for_pickup [label="3. LOWER ARM\n• Begin lowering to pickup height\n• Prepare vacuum system", fillcolor="skyblue"];
        
        activate_vacuum [label="4. START SUCTION\n• Activate vacuum\n• Begin gripping object", fillcolor="lightgreen"];
        
        continue_lower [label="5. LOWER COMPLETELY\n• Lower to final pickup position\n• Make contact with object", fillcolor="skyblue"];
        
        wait_pickup [label="6. HOLD BRIEFLY\n• Pause for 300ms\n• Ensure secure grip", fillcolor="lightgreen"];
        
        raise_with_object [label="7. RAISE OBJECT\n• Lift object from surface\n• Prepare for transport", fillcolor="skyblue"];
    }
    
    // Movement node between locations
    move_to_dropoff [label="8. TRANSFER TO DROPOFF ◼\n• Move to dropoff location\n• Rotate gripper at midpoint", fillcolor="skyblue"];
    
    // Dropoff location subgraph (uses TB direction internally)
    subgraph cluster_dropoff {
        rankdir=TB; // Enforce top to bottom within this cluster
        label = "DROPOFF LOCATION (RIGHT)";
        fontsize=16;
        fontname="Arial Bold";
        style="rounded,dashed";
        color="darkgreen";
        bgcolor="honeydew";
        penwidth=2.0;
        
        lower_for_dropoff [label="9. LOWER AT DROPOFF\n• Lower to release position\n• Prepare to release object", fillcolor="skyblue"];
        
        release_object [label="10. RELEASE OBJECT\n• Turn off suction\n• Drop object at destination", fillcolor="lightgreen"];
        
        wait_after_release [label="11. HOLD BRIEFLY\n• Pause for 100ms\n• Ensure clean release", fillcolor="lightgreen"];
        
        raise_after_dropoff [label="12. RAISE ARM\n• Lift empty gripper\n• Clear the dropoff area", fillcolor="skyblue"];
        
        signal_stage2 [label="13. SIGNAL NEXT MACHINE\n• Send signal to Stage 2\n• Indicate completion", fillcolor="lightgreen"];
    }
    
    // Return node outside of clusters
    return_to_pickup [label="14. RETURN TO START ◼\n• Move back to pickup location\n• Reset for next cycle", fillcolor="skyblue"];
    
    // Edge connections with larger font labels
    start -> move_to_pickup [label="Signal received", fontsize=12];
    move_to_pickup -> lower_for_pickup [label="At pickup location", fontsize=12];
    lower_for_pickup -> activate_vacuum [label="At vacuum height", fontsize=12];
    activate_vacuum -> continue_lower [label="Vacuum on", fontsize=12];
    continue_lower -> wait_pickup [label="Fully lowered", fontsize=12];
    wait_pickup -> raise_with_object [label="Time elapsed", fontsize=12];
    raise_with_object -> move_to_dropoff [label="Fully raised", fontsize=12];
    move_to_dropoff -> lower_for_dropoff [label="At dropoff location", fontsize=12];
    lower_for_dropoff -> release_object [label="At release height", fontsize=12];
    release_object -> wait_after_release [label="Vacuum off", fontsize=12];
    wait_after_release -> raise_after_dropoff [label="Time elapsed", fontsize=12];
    raise_after_dropoff -> signal_stage2 [label="Fully raised", fontsize=12];
    signal_stage2 -> return_to_pickup [label="Signal sent", fontsize=12];
    return_to_pickup -> start [label="Cycle complete", fontsize=12];
} 